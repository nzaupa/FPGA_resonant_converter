---
jupytext:
  formats: md:myst
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.13
    jupytext_version: 1.11.5
kernelspec:
  display_name: Python 3
  language: python
  name: python3
# header-includes:
#   - \usepackage{siunitx}
---

# Resonant Tank

The core of the resonant tank is composed by an inductor $L_r$, a capacitor $C_r$ and a transformer $T_r$ (with magnetizing inductance $L_m$). The input is a square waveform generated by an H-bridge and the output of the transformer is sinusoidal.
 
Figure 1: Resonant tank

```{margin} 
   <sup>1</sup> Indeed, the FPGA is then connected to the resonant tank through the gate driver of the H-bridge. We might think to isolate also the drivers but it not extremely necessary.
```
<!-- [^ground]: Indeed, the FPGA is then connected to the resonant tank through the gate driver of the H-bridge. We might think to isolate also the drivers but it not extremely necessary. -->

The current and the voltage on the capacitor $C_r$ is measured in order to close the loop and ensure the oscillation.
Two sensing circuits are used to measure these quantities. Thanks to the use of signal transformer, the resonant tank is galvanically isolated from the sensing output (FPGA<sup>1</sup>). 
<!-- #[^ground] -->

  

## SCHEMATICS
###	Resonant Tank

The main resonance frequency is defined as $f_r=\frac{1}{\sqrt{L_rC_r}}$. The transformer has a transformation ratio of $n$.
Maximum rating on the components for an output battery current of 10A
 - Maximum inductor current: 35A AC (high Q) -  15A AC (low Q)
 - Maximum capacitor voltage: 900V AC (high Q) -  50V AC (low Q)
 - The first winding of the current transformer has to withstand the full current, need proper size of the wire.




### Current Sensing

The capacitor current corresponds to the input current of the resonant tank. A current-transformer is used to sense it and to ensure isolation. 
The primary current is reduced at the secondary according to the transformation ratio $1:n_i$, which is then transformed to a voltage thanks to the resistor $R_i$. If we have that $R_i\ll100\Omega$, we can express the voltage sensed by the ADC as $v_{ADC}=\frac{R_i}{n_i}i_S$. The primary equivalent resistance is: $R_{T1,eq}=\frac{R_i}{n_i^2}$.
 
Figure 2: Current sensing circuit

The output of $T_1$ is connected to a SMA connector through a low pass filter with cut-off frequency $f_{rcf}=\frac{1}{\pi\ R_{rcf}C_{rcf}}$.  $R_{rcf}=50\Omega$ for impedance matching with the input stage of the ADC. 

|  |  |  |
| ----------- | ----------- |  ----------- |
| $n_i$ | 20       | $\gamma_{ri,ADC}=0.0135$ |
| $R_i$ | 270 $mΩ$ | $\max\{I_s\}=37.0\ A$ |



<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 14%" />
<col style="width: 32%" />
<col style="width: 13%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="header">
<th><span class="math display"><em>n</em><sub><em>i</em></sub></span></th>
<th>20</th>
<th rowspan="2"><p><span class="math display"><em>γ</em><sub><em>r</em><em>i</em>, <em>A</em><em>D</em><em>C</em></sub> = 0.0135</span></p>
<p><span class="math display">max {<em>I</em><sub><em>s</em></sub>} = 37.0 <em>A</em></span></p></th>
<th>20</th>
<th rowspan="2"><p><span class="math display"><em>γ</em><sub><em>r</em><em>v</em>, <em>A</em><em>D</em><em>C</em></sub> = 0.028</span></p>
<p><span class="math display">max {<em>I</em><sub><em>s</em></sub>} = 17.9 <em>A</em></span></p></th>
</tr>
<tr class="odd">
<th><span class="math display"><em>R</em><sub><em>i</em></sub></span></th>
<th>270 mΩ</th>
<th>560 mΩ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math display"><em>R</em><sub>rcf</sub></span></td>
<td>50 Ω</td>
<td rowspan="2"><span class="math display"><em>f</em><sub>rcf</sub> = 318<em>k</em><em>H</em><em>z</em></span></td>
<td colspan="2" rowspan="2">* Q high: Ri is at the limit might need to lower it</td>
</tr>
<tr class="even">
<td><span class="math display"><em>C</em><sub>rcf</sub></span></td>
<td>10 nF</td>
</tr>
</tbody>
</table>

### Voltage Sensing

The voltage is initially attenuated by a voltage divider by a factor $\frac{R_{pv2}}{R_{pv1}+R_{pv2}}$, which is then attenuated by a signal transformer with transformation ratio $n_v:1$. Therefore, we have that the voltage read by the ADC corresponds to $v_{ADC}=\frac{1}{n_v}\frac{R_{pv2}}{R_{pv1}+R_{pv2}}v_{C_r}$. Equivalent resistance at the primary is $R_{T2,eq}=2R_{rvf}n_v^2\ =40\ k\Omega$ and we need to have that $R_{pv2}\ll R_{T2,eq}$.
 
Figure 3: Voltage sensing stage in the resonant tank

Then, the output of $T_2$ is connected to a SMA connector through a low pass filter with cut-off frequency $f_{rvf}=\frac{1}{\pi\ R_{rvf}C_{rvf}}$.  $R_{rvf}=50\Omega$ for impedance matching with the input stage of the ADC.





<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 13%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="header">
<th><span class="math display"><em>n</em><sub><em>v</em></sub></span></th>
<th>20</th>
<th rowspan="3"><p><span class="math display"><em>γ</em><sub><em>r</em><em>v</em><em>i</em>, <em>A</em><em>D</em><em>C</em></sub> = 495 × 10<sup>−6</sup></span></p>
<p><span class="math display">max {<em>V</em><sub><em>c</em></sub>} = 1010<em>V</em></span></p></th>
<th>20</th>
<th rowspan="3"><p><span class="math display"><em>γ</em><sub><em>r</em><em>v</em><em>i</em>, <em>A</em><em>D</em><em>C</em></sub> = 1.47 × 10<sup>−3</sup></span></p>
<p><span class="math display">max {<em>V</em><sub><em>c</em></sub>} = 57<em>V</em></span></p></th>
</tr>
<tr class="odd">
<th><span class="math display"><em>R</em><sub><em>p</em><em>v</em>1</sub></span></th>
<th>100 kΩ</th>
<th>4.7 kΩ</th>
</tr>
<tr class="header">
<th><span class="math display"><em>R</em><sub><em>p</em><em>v</em>2</sub></span></th>
<th>1 kΩ</th>
<th>1 kΩ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math display"><em>R</em><sub>rvf</sub></span></td>
<td>50 Ω</td>
<td rowspan="2"><span class="math display"><em>f</em><sub>rcf</sub> = 318<em>k</em><em>H</em><em>z</em></span></td>
<td colspan="2" rowspan="2">* Q low: we might reduce <span class="math inline"><em>n</em><sub><em>v</em></sub> <em>a</em><em>n</em><em>d</em> <em>i</em><em>n</em><em>c</em><em>r</em><em>e</em><em>a</em><em>s</em><em>e</em> <em>R</em>_{<em>p</em><em>v</em>1}</span> we should keep the total resistance not too low (10mA)</td>
</tr>
<tr class="even">
<td><span class="math display"><em>C</em><sub>rvf</sub></span></td>
<td>10 nF</td>
</tr>
</tbody>
</table>



## PCB BOARD

Two resonant tanks will be built. One with low nominal quality factor and one with high nominal quality factor.

###	Connectors

 - Power input/output: HDR 2x10 (half connector per polarity)
 - Sensing SMA connectors + HDR 1x2 (for oscilloscope: before the 50 Ohm resistance)
GND of the SMA connector on the FPGA is connected to the common ADC ground. i.e. can create a common ground plate on the PCB.



### Components list 

|                    | values        | Description                 | code                  | manufacture |
|--------------------|---------------|-----------------------------|-----------------------|-------------|
| $L_{r}$            | 68uH (10uH)   | Power DC inductor           | AGP4233-683ME (103ME) | Coilcraft   |
| $C_{r}$            | 100nF (700nF) | 1kVDC – C0G (NP0) - SMD     | CKC21C104KDGLC7805    | Kemet       |
| $T_{r}$            | 1:1           | Lm=245uH                    | B65982E0012D001       | TDK         |
| $T_{1}$            | 1:ni          | toroid 12.7 × 7.15 × 4.9 mm | 5977000301 core       | Fair-Rite   |
| $T_{2}$            | nv:1          | toroid 12.7 × 7.15 × 4.9 mm | 5977000301 core       | Fair-Rite   |
| $R_{p1}$           | 100 kΩ        | through-hole resistance ¼W  | Precision \<1%        |             |
| $R_{p2}$           | 1 kΩ          | through-hole resistance ¼W  | Precision \<1%        |             |
| $R_{i}$            | 0.5 Ω         | through-hole resistance ¼W  | Precision \<1%        |             |
| $R_{\text{rcf}}$   | 50 Ω          | through-hole resistance ¼W  | Precision \<1%        |             |
| $R_{\text{rvf}}$   | 50 Ω          | through-hole resistance ¼W  | Precision \<1%        |             |
| $C_{\text{rcf}}$   | nF            | film capacitor              |                       |             |
| $C_{\text{rvf}}$   | nF            | film capacitor              |                       |             |
| **CONNECTORS**     |               |                             |                       |             |
| J3-J6              | ×2            | header 1×2                  |                       |             |
| J1-J2              | ×2            | Header 2×10                 |                       |             |
| TP                 | ×6            | Test point 1.6mm            |                       |             |
| SMA                | ×2            | FPGA connectors             | SMA-TH-vertical       |             |
| J7                 | ×1            | current jumper (wire)       |                       |             |




**RESONANT TANK**

| Units | Description                                                        | Code                    |
|-------|--------------------------------------------------------------------|-------------------------|
|       |                                                                    | **To buy?**             |
| ×10   | Multilayer Ceramic Capacitors - SMD/SMT 1kV 0.1uF 1812 10%         | CKC21C104KDGLC7805      |
|       |                                                                    | **Already in the lab?** |
| ×1    | Power Inductors - Leaded 68uH Shld 20% 24A 2.95mOhms               | AGP4233-683ME (Carlos)  |
| ×1    | Power Inductors - Leaded 10uH Shld 20% 24A 2.95mOhms               | AGP4233-103ME (Carlos)  |
| ×2    | Handcraft transformer. Two magnetizing inductance: 245uH and 30uH  | B65982E0012D001         |
| ×4    | Handcraft signal transformer                                       | core: 5977000301        |
| ×10   | \<1% resistor (¼W)                                                 |                         |
| ×4    | Film capacitor for filtering                                       |                         |
| ×12   | Test point 1.6mm                                                   |                         |
| ×12   | Test point 1mm                                                     |                         |
| ×4    | Coaxial Connectors 6 GHz, 50 Ohm SMA Jack or Plug, Cable Connector | SMA-J-P-H-ST-MT1        |
| ×4    | Header 2×10                                                        | HDR2x10                 |
| ×4    | Oscilloscope probe test point                                      | 129-0701-201(202)       |