

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Sensing &#8212; Resonant Converter 2023</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=927b94d3fcb96560df09"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/design/RC_sensing';</script>
    <link rel="shortcut icon" href="../../_static/logo2.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ADCs" href="RC_ADC.html" />
    <link rel="prev" title="Rectifier" href="RC_rectifier_design.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo2.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/logo2.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Index
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/state_of_the_art.html">State of the Art</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/SOTA_resonant_converter.html">Resonant Converters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/SOTA_obc.html">OBC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/SOTA_biblio.html">Bibliography</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intro/developments.html">Developments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/publications.html">Publications</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Control</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../control/RT_control.html">Oscillation controls</a></li>
<li class="toctree-l1"><a class="reference internal" href="../control/RC_control.html">Closed-loop control</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Electronic design</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="power_stage.html">Power stage</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="RT_resonant_tank_design.html">Resonant Tank</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="RT_sensing.html">Sensing</a></li>
<li class="toctree-l2"><a class="reference internal" href="RT_signal_transformer_design.html">Signal Transformers</a></li>
<li class="toctree-l2"><a class="reference internal" href="RT_trafo_calc.html">Transformer calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="RT_pcb.html">PCB design</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="RC_rectifier_design.html">Rectifier</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Sensing</a></li>
<li class="toctree-l2"><a class="reference internal" href="RC_ADC.html">ADCs</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation.html">Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="RC_pcb.html">PCB design</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">FPGA programming</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../programming/HDL_env.html">HDL Environment</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../programming/quartus.html">Quartus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../programming/VSC_env.html">Visual Studio Code</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../programming/verilog_guide.html">Verilog coding</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../programming/modules.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../programming/statements.html">Statements and Blocks</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../programming/project_code.html">Project Code</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../programming/blocks.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../programming/code_structure.html">Code structure</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Diary</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../diary/2020_diary.html">Diary 2020-2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="../diary/2023_diary.html">Diary 2023</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../markdown-notebooks.html">Some ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../markdown.html">Markdown Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks.html">Alt tit toc</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Useful Material</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../handbook/useful_material.html">LAB electronics tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../handbook/altium_help.html">Altium</a></li>
<li class="toctree-l1"><a class="reference internal" href="../handbook/FPGA_board.html">FPGA board</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/nzaupa/FPGA_resonant_converter" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/docs/design/RC_sensing.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Sensing</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#battery-current-sensing">Battery Current Sensing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#battery-voltage-sensing">Battery Voltage Sensing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acpl-supply">ACPL supply</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="sensing">
<h1>Sensing<a class="headerlink" href="#sensing" title="Permalink to this heading">#</a></h1>
<p>We need to sense DC values to close the loop, mainly the current. The voltage is used more for a safety reason.</p>
<p>The power supply for the electronics in the sensing part (ADCs + OPA)
can be taken from the FPGA, which has 3.3V and 5V pins on the GPIO
40-pin socket.</p>
<p>The requirement behind this sensing stage is to keep the ground of the battery separated from the one of the FPGA.
To this end, we aim at using isolated sensors. Therefore, for the current a Hall effect sensor is used; while, for the voltage an isolated operational amplifier is used.
Outputs of the sensors are actively filter with operational amplifiers (LPF) to reduce the noise. Finally, ADCs are used to transform the signals in digital ones, directly connected to the
FPGA with a parallel interface.</p>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="../../_images/RC_chain.png"><img alt="../../_images/RC_chain.png" src="../../_images/RC_chain.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Scheme of the main stages in the circuit</span><a class="headerlink" href="#id1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>sensor range must be compatible with the measurement to be done</p></li>
<li><p>sensor output must be compatible with the ADC input</p></li>
</ul>
<hr class="docutils" />
<section id="battery-current-sensing">
<h2>Battery Current Sensing<a class="headerlink" href="#battery-current-sensing" title="Permalink to this heading">#</a></h2>
<p>For the current, there are two isolated options:</p>
<ol class="arabic simple">
<li><p>Hall-effect sensor;</p></li>
<li><p>Shunt resistor with isolated op-amp.
One main difference is that the Hall-sensor does not require power supply in the input side, whereas the isolated opamp need it to work.</p></li>
</ol>
<p>The final choice is for a Hall effect sensor. One common possibility comes from the LEM family, in particular the HO series. They are distinguished by the current range (6/10/25) and the supply voltage in the output side (3.3/5 V).</p>
<p>The output voltage depends on: a fixed gain <span class="math notranslate nohighlight">\(\gamma\)</span>, the number of turns <span class="math notranslate nohighlight">\(N\)</span>, and an offset
defined by <span class="math notranslate nohighlight">\(V_{\text{ref}}\)</span>, which corresponds to half of the supply voltage.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Based on the sensor shape, the current can be sensed with:</p>
<ol class="arabic simple">
<li><p>a wire wrapped around the hole and the number of turns <span class="math notranslate nohighlight">\(N\)</span> is free;</p></li>
<li><p>the pins, every couple is a wind, therefore they can be connected in parallel, i.e. <span class="math notranslate nohighlight">\(N=1\)</span>; or following a configuration to reach up to <span class="math notranslate nohighlight">\(N=3\)</span>.</p></li>
</ol>
</div>
<p>The general simplified input-output relation is the following</p>
<div class="math notranslate nohighlight">
\[v_{\text{sens}} = \gamma \times N \times I_P + V_{\text{ref}}\]</div>
<p>At <span class="math notranslate nohighlight">\(I_P=0\)</span> the output voltage is <span class="math notranslate nohighlight">\(V_{out}=V_{ref}+V_{OE}\)</span>, with <span class="math notranslate nohighlight">\(V_{\text{OE}} \in \lbrack -10,10\rbrack\text{mV}\)</span>.</p>
<p>Some data from the series</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>series</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(+U_c\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(V_{ref}\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(\gamma\)</span></p></th>
<th class="head"><p>input range</p></th>
<th class="head"><p>nominal rms</p></th>
<th class="head"><p>output range <span class="math notranslate nohighlight">\(|V_{out}-V_{ref}|\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>HO 6-P</strong></p></td>
<td><p><span class="math notranslate nohighlight">\(5\;V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.5\;V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(100\;mV/A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pm20\;A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(6\;A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pm2\;V\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><strong>HO 10-P</strong></p></td>
<td><p><span class="math notranslate nohighlight">\(5\;V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.5\;V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(80\;mV/A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pm25\;A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(10\;A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pm2\;V\)</span></p></td>
</tr>
<tr class="row-even"><td><p><strong>HO 25-P</strong></p></td>
<td><p><span class="math notranslate nohighlight">\(5\;V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2.5\;V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(32\;mV/A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pm62.5\;A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(25\;A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pm2\;V\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><strong>HO 6-P/SP33</strong></p></td>
<td><p><span class="math notranslate nohighlight">\(3.3\;V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.65\;V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(76.67\;mV/A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pm20\;A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(6\;A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pm1.15\;V\)</span></p></td>
</tr>
<tr class="row-even"><td><p><strong>HO 10-P/SP33</strong></p></td>
<td><p><span class="math notranslate nohighlight">\(3.3\;V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.65\;V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(46\;mV/A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pm25\;A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(10\;A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pm1.15\;V\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><strong>HO 25-P/SP33</strong></p></td>
<td><p><span class="math notranslate nohighlight">\(3.3\;V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1.65\;V\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(18.4\;mV/A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pm62.5\;A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(25\;A\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\pm1.15\;V\)</span></p></td>
</tr>
</tbody>
</table>
<p>The maximum current consumption is of 25 mA.</p>
<figure class="align-default" id="id2">
<a class="reference internal image-reference" href="../../_images/RC_LEM_internal_scheme.png"><img alt="../../_images/RC_LEM_internal_scheme.png" src="../../_images/RC_LEM_internal_scheme.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Operational principle of HO x-P</span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>More complete model from the datasheet:</p>
<div class="math notranslate nohighlight">
\[V_{\text{out}} = 0.08N_pI_p + \epsilon + V_{\text{OE}},\quad\quad V_{\text{OE}} \in \lbrack -10,10\rbrack\text{mV}\]</div>
<p>The output of the sensor is then conditioned in order to attenuate the
amplitude and filter it with a LPF. There is a first stage reducing and
filtering, then the opamp could be use either to as a voltage follower
or an amplifier (gain&gt;1).</p>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="../../_images/RC_current_sensing.png"><img alt="../../_images/RC_current_sensing.png" src="../../_images/RC_current_sensing.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 8 </span><span class="caption-text">Current sensing stage</span><a class="headerlink" href="#id3" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The LPF cut-off frequency is
<span class="math notranslate nohighlight">\(f_{i} = \frac{1}{2\pi\left( R_{if1}\text{//}R_{if2} \right)C_{\text{if}}}\)</span>
with DC gain <span class="math notranslate nohighlight">\(\frac{R_{if2}}{R_{if1} + R_{if2}}\)</span> and the gain of the op
amp is <span class="math notranslate nohighlight">\(1 + \frac{R_{i2}}{R_{i1}}\)</span></p>
<figure class="align-default" id="id4">
<a class="reference internal image-reference" href="../../_images/RC_current_chain.png"><img alt="../../_images/RC_current_chain.png" src="../../_images/RC_current_chain.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 9 </span><span class="caption-text">gain and filter chain under approximation</span><a class="headerlink" href="#id4" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="battery-voltage-sensing">
<h2>Battery Voltage Sensing<a class="headerlink" href="#battery-voltage-sensing" title="Permalink to this heading">#</a></h2>
<p>As for the current, we want to keep the measurement isolated. Therefore, the sensing of the battery voltage is done with an isolated op amp. A typical series used at this end is the ACPL from Avago Technologies / BROADCOM®.</p>
<p>The voltage is initially reduced with a voltage divider and it is filtered
with a LPF. The sensor is the ACPL-790B-000E, which has a fix gain of
8.2 with differential input and output. The signal is then referenced to
ground with a differential op amp, which includes another LPF stage.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ACPL-790B-000E</p></td>
<td><p>Isolated opamp with <span class="math notranslate nohighlight">\(\pm 0.5\%\)</span> High Gain Accuracy with fixed gain <span class="math notranslate nohighlight">\(\times8.2\)</span>. Supply voltage: from 3V to 5.5V for the output side; 5V for the input side. 200kHz bandwidth. DIP-8 package. Input range <span class="math notranslate nohighlight">\(V_{in+}\Leftrightarrow\pm\)</span> 200mV recommended. Power consumption: 18.5mA on the input side and 12mA on the output side.</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The ACPL has an input resistance of 27 kΩ. Therefore, we cannot threat it as a standard high-impedance input operational amplifier.</p>
</div>
<figure class="align-default" id="id5">
<a class="reference internal image-reference" href="../../_images/RC_voltage_sensing.png"><img alt="../../_images/RC_voltage_sensing.png" src="../../_images/RC_voltage_sensing.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 10 </span><span class="caption-text">Voltage sensing stage</span><a class="headerlink" href="#id5" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>In ideal condition (almost constant voltage on <span class="math notranslate nohighlight">\(R_{p2}\)</span>), the input
differential voltage corresponds to
<span class="math notranslate nohighlight">\(v_{\text{in}} = \frac{R_{p2}}{R_{p1} + R_{p2}}v_{\text{bat}}\)</span> and the
cut-off frequency of the input filter is
<span class="math notranslate nohighlight">\(f_{\text{vi}} = \frac{1}{2\pi R_{\text{vf}}C_{\text{vf}}}\)</span>. We also
need <span class="math notranslate nohighlight">\(R_{\text{vf}} \gg R_{p2}\)</span> to have a “simplified” version of the
cut-off frequency</p>
<p>Full transfer function <span class="math notranslate nohighlight">\(V_{\text{bat}} \rightarrow V_{\text{in}}\)</span> is
<span class="math notranslate nohighlight">\(H(s) = \frac{R_{p2}}{R_{p1} + R_{p2}}\frac{1}{1 + s\left( R_{\text{vf}} + \frac{R_{p2}R_{p1}}{R_{p1} + R_{p2}} \right)C_{\text{vf}}}\)</span></p>
<p><strong>the expression with the ACPL input impedance can be added</strong></p>
<p>Take care that the input to the differential opamp has to have an
amplitude less than 200mV.</p>
<p>The final op amp has a static gain of <span class="math notranslate nohighlight">\(\frac{R_{v2}}{R_{v1}}\)</span> and a
cut-off frequency of <span class="math notranslate nohighlight">\(f_{\text{vo}} = \frac{1}{2\pi R_{v2}C_{v}}\)</span>.</p>
<p>The total chain gain is:
<span class="math notranslate nohighlight">\(\gamma_{v_{\text{bat}}} = \frac{R_{p2}}{R_{p1} + R_{p2}}8.2\frac{R_{v2}}{R_{v1}}\ \)</span>
with two cut-off frequency for a LPF.</p>
<figure class="align-default" id="id6">
<a class="reference internal image-reference" href="../../_images/RC_voltage_chain.png"><img alt="../../_images/RC_voltage_chain.png" src="../../_images/RC_voltage_chain.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 11 </span><span class="caption-text">gain and filter chain under approximation</span><a class="headerlink" href="#id6" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<section id="acpl-supply">
<h3>ACPL supply<a class="headerlink" href="#acpl-supply" title="Permalink to this heading">#</a></h3>
<p>The voltage sensor needs to be powered from both sides. On the battery
side it requires a 5V supply. To ensure it we can take the battery
voltage and stabilize it through a linear regulator. We need to consider
that the drop voltage will be high, i.e. we are reducing to 5V and input
voltage of about 60V. One option that is able to bear this input voltage
is the ZXTR2105FF, which allows a maximum input voltage of 60V. Bypass
capacitors of 1uf and 10uF are suggested, 1uF in input highly suggested
with high input voltage. Are these capacitors available in SMD format?</p>
<p>For flexibility, a choice between battery voltage and external supply is
possible through a jumper.</p>
<figure class="align-default" id="id7">
<a class="reference internal image-reference" href="../../_images/RC_voltage_regulator.png"><img alt="../../_images/RC_voltage_regulator.png" src="../../_images/RC_voltage_regulator.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 12 </span><span class="caption-text">5V linear voltage regulator on the battery side</span><a class="headerlink" href="#id7" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs\design"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="RC_rectifier_design.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Rectifier</p>
      </div>
    </a>
    <a class="right-next"
       href="RC_ADC.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">ADCs</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#battery-current-sensing">Battery Current Sensing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#battery-voltage-sensing">Battery Voltage Sensing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acpl-supply">ACPL supply</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Nicola ZAUPA
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>